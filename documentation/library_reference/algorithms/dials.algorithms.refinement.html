

<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>dials.algorithms.refinement &#8212; DIALS  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" href="../../../_static/dials-styles.css" type="text/css" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="dials.algorithms.scaling" href="dials.algorithms.scaling.html" />
    <link rel="prev" title="dials.algorithms.profile_model" href="dials.algorithms.profile_model.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="logoheader container">
  <a href="../../../index.html">
  <img class="logoheader" alt="DIALS" src="../../../_static/dials_header.png" />
  </a>
  </div>
  

  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-dials.algorithms.refinement.reflection_manager">
<span id="dials-algorithms-refinement"></span><h1>dials.algorithms.refinement<a class="headerlink" href="#module-dials.algorithms.refinement.reflection_manager" title="Link to this heading">¶</a></h1>
<p>Contains classes used to manage the reflections used during refinement,
principally ReflectionManager.</p>
<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.BlockCalculator">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.reflection_manager.</span></span><span class="sig-name descname"><span class="pre">BlockCalculator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#BlockCalculator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Utility class to calculate and set columns in the provided reflection
table, which will be used during scan-varying refinement. The columns are a
‘block’ number and an associated ‘block_centre’, giving the image number in
the centre of the block</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.BlockCalculator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#BlockCalculator.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.BlockCalculator.per_image">
<span class="sig-name descname"><span class="pre">per_image</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#BlockCalculator.per_image"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator.per_image" title="Link to this definition">¶</a></dt>
<dd><p>Set one block per image for all experiments</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.BlockCalculator.per_width">
<span class="sig-name descname"><span class="pre">per_width</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#BlockCalculator.per_width"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator.per_width" title="Link to this definition">¶</a></dt>
<dd><p>Set blocks for all experiments according to a constant width</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.LaueReflectionManager">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.reflection_manager.</span></span><span class="sig-name descname"><span class="pre">LaueReflectionManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nref_per_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">close_to_spindle_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.02</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan_margin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outlier_detector</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighting_strategy_override</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wavelength_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10000000.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#LaueReflectionManager"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.LaueReflectionManager" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager" title="dials.algorithms.refinement.reflection_manager.ReflectionManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReflectionManager</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.LaueReflectionManager.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nref_per_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">close_to_spindle_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.02</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan_margin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outlier_detector</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighting_strategy_override</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wavelength_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10000000.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#LaueReflectionManager.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.LaueReflectionManager.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.LaueReflectionManager.experiment_type">
<span class="sig-name descname"><span class="pre">experiment_type</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'laue'</span></em><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.LaueReflectionManager.experiment_type" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.LaueReflectionManager.print_stats_on_matches">
<span class="sig-name descname"><span class="pre">print_stats_on_matches</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#LaueReflectionManager.print_stats_on_matches"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.LaueReflectionManager.print_stats_on_matches" title="Link to this definition">¶</a></dt>
<dd><p>Print some basic statistics on the matches</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.LaueReflectionManager.update_residuals">
<span class="sig-name descname"><span class="pre">update_residuals</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#LaueReflectionManager.update_residuals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.LaueReflectionManager.update_residuals" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.reflection_manager.</span></span><span class="sig-name descname"><span class="pre">ReflectionManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nref_per_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">close_to_spindle_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.02</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan_margin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outlier_detector</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighting_strategy_override</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A class to maintain information about observed and predicted
reflections for refinement.</p>
<p>This new version keeps the reflections as a reflection table. Initialisation
is not complete until the ReflectionManager is paired with a target function.
Then, prediction can be done, followed by outlier rejection and any random
sampling to form the working subset.</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nref_per_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">close_to_spindle_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.02</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan_margin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outlier_detector</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighting_strategy_override</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.experiment_type">
<span class="sig-name descname"><span class="pre">experiment_type</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'scans'</span></em><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.experiment_type" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.filter_obs">
<span class="sig-name descname"><span class="pre">filter_obs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sel</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.filter_obs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.filter_obs" title="Link to this definition">¶</a></dt>
<dd><p>Perform a flex array selection on the managed observations, so that
external classes can filter according to criteria not available here</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.finalise">
<span class="sig-name descname"><span class="pre">finalise</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">analysis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.finalise"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.finalise" title="Link to this definition">¶</a></dt>
<dd><p>Complete initialisation by performing outlier rejection and any
requested subsetting. If a list of results from a CentroidAnalysis
object is provided, these may be used to determine outlier rejection
block widths</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_accepted_refs_size">
<span class="sig-name descname"><span class="pre">get_accepted_refs_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_accepted_refs_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_accepted_refs_size" title="Link to this definition">¶</a></dt>
<dd><p>Return the number of observations that pass inclusion criteria and
can potentially be used for refinement</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_centroid_analyser">
<span class="sig-name descname"><span class="pre">get_centroid_analyser</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_centroid_analyser"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_centroid_analyser" title="Link to this definition">¶</a></dt>
<dd><p>Create a CentroidAnalysis object for the current reflections</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_free_reflections">
<span class="sig-name descname"><span class="pre">get_free_reflections</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_free_reflections"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_free_reflections" title="Link to this definition">¶</a></dt>
<dd><p>Return all reflections that were accepted for refinement but not chosen
in the working set</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_indexed">
<span class="sig-name descname"><span class="pre">get_indexed</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_indexed"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_indexed" title="Link to this definition">¶</a></dt>
<dd><p>Return the reflections passed in as input</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_matches">
<span class="sig-name descname"><span class="pre">get_matches</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_matches"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_matches" title="Link to this definition">¶</a></dt>
<dd><p>For every observation used in refinement return (a copy of) all data</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_obs">
<span class="sig-name descname"><span class="pre">get_obs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_obs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_obs" title="Link to this definition">¶</a></dt>
<dd><p>Get the list of managed observations</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_sample_size">
<span class="sig-name descname"><span class="pre">get_sample_size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_sample_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_sample_size" title="Link to this definition">¶</a></dt>
<dd><p>Return the number of observations in the working set to be
used for refinement</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.print_stats_on_matches">
<span class="sig-name descname"><span class="pre">print_stats_on_matches</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.print_stats_on_matches"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.print_stats_on_matches" title="Link to this definition">¶</a></dt>
<dd><p>Print some basic statistics on the matches</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.reset_accepted_reflections">
<span class="sig-name descname"><span class="pre">reset_accepted_reflections</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.reset_accepted_reflections"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.reset_accepted_reflections" title="Link to this definition">¶</a></dt>
<dd><p>Reset use flags for all observations in preparation for a new set of
predictions</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManager.update_residuals">
<span class="sig-name descname"><span class="pre">update_residuals</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.update_residuals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.update_residuals" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.reflection_manager.</span></span><span class="sig-name descname"><span class="pre">ReflectionManagerFactory</span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManagerFactory"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory.from_parameters_reflections_experiments">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_parameters_reflections_experiments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_stills</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManagerFactory.from_parameters_reflections_experiments"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory.from_parameters_reflections_experiments" title="Link to this definition">¶</a></dt>
<dd><p>Given a set of parameters and models, build a reflection manager</p>
<dl class="simple">
<dt>Params:</dt><dd><p>params The input parameters</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The reflection manager instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory.get_weighting_strategy_override">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_weighting_strategy_override</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">scope_extract</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy"><span class="pre">StatisticalWeightingStrategy</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy" title="dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy"><span class="pre">ConstantWeightingStrategy</span></a></span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManagerFactory.get_weighting_strategy_override"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory.get_weighting_strategy_override" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory.laue_manager">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">laue_manager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../dxtbx/experiment_list.html#dxtbx.model.ExperimentList" title="dxtbx_model_ext.ExperimentList"><span class="pre">ExperimentList</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflections</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">reflection_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">scope_extract</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.LaueReflectionManager" title="dials.algorithms.refinement.reflection_manager.LaueReflectionManager"><span class="pre">LaueReflectionManager</span></a></span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManagerFactory.laue_manager"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory.laue_manager" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory.rotation_scan_manager">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">rotation_scan_manager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../dxtbx/experiment_list.html#dxtbx.model.ExperimentList" title="dxtbx_model_ext.ExperimentList"><span class="pre">ExperimentList</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflections</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">reflection_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">scope_extract</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager" title="dials.algorithms.refinement.reflection_manager.ReflectionManager"><span class="pre">ReflectionManager</span></a></span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManagerFactory.rotation_scan_manager"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory.rotation_scan_manager" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory.stills_manager">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">stills_manager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../dxtbx/experiment_list.html#dxtbx.model.ExperimentList" title="dxtbx_model_ext.ExperimentList"><span class="pre">ExperimentList</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflections</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">reflection_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">scope_extract</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.StillsReflectionManager" title="dials.algorithms.refinement.reflection_manager.StillsReflectionManager"><span class="pre">StillsReflectionManager</span></a></span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManagerFactory.stills_manager"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory.stills_manager" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.StillsReflectionManager">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.reflection_manager.</span></span><span class="sig-name descname"><span class="pre">StillsReflectionManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nref_per_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">close_to_spindle_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.02</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan_margin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outlier_detector</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighting_strategy_override</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#StillsReflectionManager"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.StillsReflectionManager" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager" title="dials.algorithms.refinement.reflection_manager.ReflectionManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReflectionManager</span></code></a></p>
<p>Overloads for a Reflection Manager that does not exclude
reflections too close to the spindle, and reports only information
about X, Y, DelPsi residuals</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.StillsReflectionManager.experiment_type">
<span class="sig-name descname"><span class="pre">experiment_type</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'stills'</span></em><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.StillsReflectionManager.experiment_type" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.StillsReflectionManager.print_stats_on_matches">
<span class="sig-name descname"><span class="pre">print_stats_on_matches</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#StillsReflectionManager.print_stats_on_matches"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.StillsReflectionManager.print_stats_on_matches" title="Link to this definition">¶</a></dt>
<dd><p>Print some basic statistics on the matches</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.TOFReflectionManager">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.reflection_manager.</span></span><span class="sig-name descname"><span class="pre">TOFReflectionManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nref_per_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">close_to_spindle_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.02</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan_margin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outlier_detector</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighting_strategy_override</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wavelength_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10000000.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#TOFReflectionManager"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.TOFReflectionManager" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.LaueReflectionManager" title="dials.algorithms.refinement.reflection_manager.LaueReflectionManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">LaueReflectionManager</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.TOFReflectionManager.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nref_per_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">close_to_spindle_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.02</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan_margin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outlier_detector</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighting_strategy_override</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wavelength_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10000000.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#TOFReflectionManager.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.TOFReflectionManager.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.reflection_manager.TOFReflectionManager.update_residuals">
<span class="sig-name descname"><span class="pre">update_residuals</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#TOFReflectionManager.update_residuals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.TOFReflectionManager.update_residuals" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<p id="module-dials.algorithms.refinement.weighting_strategies">Contains classes used to provide weighting schemes as strategies for
ReflectionManagers.</p>
<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.weighting_strategies.</span></span><span class="sig-name descname"><span class="pre">ConstantWeightingStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stills</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ConstantWeightingStrategy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stills</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ConstantWeightingStrategy.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.calculate_weights">
<span class="sig-name descname"><span class="pre">calculate_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ConstantWeightingStrategy.calculate_weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.calculate_weights" title="Link to this definition">¶</a></dt>
<dd><p>Set weights to constant terms. If stills, the z weights are
the ‘delpsical.weights’ attribute of the reflection table. Otherwise, use
the usual ‘xyzobs.mm.weights’</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.weighting_strategies.</span></span><span class="sig-name descname"><span class="pre">ExternalDelPsiWeightingStrategy</span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ExternalDelPsiWeightingStrategy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">StatisticalWeightingStrategy</span></code></a></p>
<p>Defines a single method that provides a ReflectionManager with a strategy
for calculating weights for stills refinement. This version uses statistical
weights for X and Y and assume that the Delta Psi part is already provided in
the reflection table</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy.calculate_weights">
<span class="sig-name descname"><span class="pre">calculate_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ExternalDelPsiWeightingStrategy.calculate_weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy.calculate_weights" title="Link to this definition">¶</a></dt>
<dd><p>Statistical weights for X, Y. Weights for DeltaPsi must be already
provided in the reflection table</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.LaueMixedWeightingStrategy">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.weighting_strategies.</span></span><span class="sig-name descname"><span class="pre">LaueMixedWeightingStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wavelength_weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10000000.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#LaueMixedWeightingStrategy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.LaueMixedWeightingStrategy" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">StatisticalWeightingStrategy</span></code></a></p>
<p>Use statistical weighting for x and y, and constant weighting for z</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.LaueMixedWeightingStrategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wavelength_weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10000000.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#LaueMixedWeightingStrategy.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.LaueMixedWeightingStrategy.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.LaueMixedWeightingStrategy.calculate_weights">
<span class="sig-name descname"><span class="pre">calculate_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#LaueMixedWeightingStrategy.calculate_weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.LaueMixedWeightingStrategy.calculate_weights" title="Link to this definition">¶</a></dt>
<dd><p>set ‘statistical weights’, that is w(x) = 1/var(x)</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.LaueStatisticalWeightingStrategy">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.weighting_strategies.</span></span><span class="sig-name descname"><span class="pre">LaueStatisticalWeightingStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wavelength_weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10000000.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#LaueStatisticalWeightingStrategy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.LaueStatisticalWeightingStrategy" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">StatisticalWeightingStrategy</span></code></a></p>
<p>Variance in z estimated from sqrt(x^2+y^2)</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.LaueStatisticalWeightingStrategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wavelength_weight</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10000000.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#LaueStatisticalWeightingStrategy.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.LaueStatisticalWeightingStrategy.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.LaueStatisticalWeightingStrategy.calculate_weights">
<span class="sig-name descname"><span class="pre">calculate_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#LaueStatisticalWeightingStrategy.calculate_weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.LaueStatisticalWeightingStrategy.calculate_weights" title="Link to this definition">¶</a></dt>
<dd><p>set ‘statistical weights’, that is w(x) = 1/var(x)</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.weighting_strategies.</span></span><span class="sig-name descname"><span class="pre">StatisticalWeightingStrategy</span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StatisticalWeightingStrategy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Defines a single method that provides a ReflectionManager with a strategy
for calculating weights for refinement</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy.calculate_weights">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StatisticalWeightingStrategy.calculate_weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy.calculate_weights" title="Link to this definition">¶</a></dt>
<dd><p>set ‘statistical weights’, that is w(x) = 1/var(x)</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.weighting_strategies.</span></span><span class="sig-name descname"><span class="pre">StillsWeightingStrategy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">delpsi_constant</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StillsWeightingStrategy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">StatisticalWeightingStrategy</span></code></a></p>
<p>Defines a single method that provides a ReflectionManager with a strategy
for calculating weights for refinement. This version uses statistical weights
for X and Y and a fixed constant for the delta Psi part, defaulting to 1000000</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">delpsi_constant</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StillsWeightingStrategy.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.calculate_weights">
<span class="sig-name descname"><span class="pre">calculate_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StillsWeightingStrategy.calculate_weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.calculate_weights" title="Link to this definition">¶</a></dt>
<dd><p>Include weights for DeltaPsi</p>
</dd></dl>

</dd></dl>

<p id="module-dials.algorithms.refinement.refiner">Refiner is the refinement module public interface. RefinerFactory is
what should usually be used to construct a Refiner.</p>
<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.refiner.</span></span><span class="sig-name descname"><span class="pre">Refiner</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pred_param</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_reporter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refman</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refinery</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Public interface for performing DIALS refinement.</p>
<dl class="simple">
<dt>Public methods:</dt><dd><p>run
rmsds
get_experiments
get_matches
get_param_reporter
parameter_correlation_plot
selection_used_for_refinement
predict_for_reflection_table
predict_for_indexed</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The return value of run is a recorded history of the refinement</p></li>
<li><p>The experiments accessor provides a copy of the experiments used by
refinement</p></li>
<li><p>get_matches exposes the function of the same name from the privately
stored reflection manager</p></li>
<li><p>The return value of selection_used_for_refinement is a flex.bool</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pred_param</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_reporter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refman</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refinery</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Mandatory arguments:</dt><dd><p>experiments - a dxtbx ExperimentList object
pred_param - An object derived from the PredictionParameterisation class
param_reporter -A ParameterReporter object
refman - A ReflectionManager object
target - An object derived from the Target class
refinery - An object derived from the Refinery class</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.calc_exp_rmsd_table">
<span class="sig-name descname"><span class="pre">calc_exp_rmsd_table</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.calc_exp_rmsd_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.calc_exp_rmsd_table" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.get_experiments">
<span class="sig-name descname"><span class="pre">get_experiments</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_experiments"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_experiments" title="Link to this definition">¶</a></dt>
<dd><p>Return a copy of the current refiner experiments</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.get_free_reflections">
<span class="sig-name descname"><span class="pre">get_free_reflections</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_free_reflections"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_free_reflections" title="Link to this definition">¶</a></dt>
<dd><p>Delegated to the reflection manager</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.get_matches">
<span class="sig-name descname"><span class="pre">get_matches</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_matches"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_matches" title="Link to this definition">¶</a></dt>
<dd><p>Delegated to the reflection manager</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.get_param_reporter">
<span class="sig-name descname"><span class="pre">get_param_reporter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_param_reporter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_param_reporter" title="Link to this definition">¶</a></dt>
<dd><p>Get the ParameterReport object linked to this Refiner</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.get_parameter_correlation_matrix">
<span class="sig-name descname"><span class="pre">get_parameter_correlation_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_select</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_parameter_correlation_matrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_parameter_correlation_matrix" title="Link to this definition">¶</a></dt>
<dd><p>Return the correlation matrix between columns of the Jacobian at
the specified refinement step. The parameter col_select can be used
to select subsets of the full number of columns. The column labels
are also returned as a list of strings</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.history">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">history</span></span><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.history" title="Link to this definition">¶</a></dt>
<dd><p>Get the refinement engine’s step history</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.predict_for_indexed">
<span class="sig-name descname"><span class="pre">predict_for_indexed</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.predict_for_indexed"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.predict_for_indexed" title="Link to this definition">¶</a></dt>
<dd><p>perform prediction for all the indexed reflections passed into
refinement and additionally set the used_in_refinement flag. Do not
compose the derivatives of states of the model as this is expensive and
they are not needed outside of a refinement run</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.predict_for_reflection_table">
<span class="sig-name descname"><span class="pre">predict_for_reflection_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_derivatives</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.predict_for_reflection_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.predict_for_reflection_table" title="Link to this definition">¶</a></dt>
<dd><p>perform prediction for all reflections in the supplied table</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.print_exp_rmsd_table">
<span class="sig-name descname"><span class="pre">print_exp_rmsd_table</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_exp_rmsd_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_exp_rmsd_table" title="Link to this definition">¶</a></dt>
<dd><p>print useful output about refinement steps in the form of a simple table</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.print_out_of_sample_rmsd_table">
<span class="sig-name descname"><span class="pre">print_out_of_sample_rmsd_table</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_out_of_sample_rmsd_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_out_of_sample_rmsd_table" title="Link to this definition">¶</a></dt>
<dd><p>print out-of-sample RSMDs per step, if these were tracked</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.print_panel_rmsd_table">
<span class="sig-name descname"><span class="pre">print_panel_rmsd_table</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_panel_rmsd_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_panel_rmsd_table" title="Link to this definition">¶</a></dt>
<dd><p>print useful output about refinement steps in the form of a simple table</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.print_step_table">
<span class="sig-name descname"><span class="pre">print_step_table</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_step_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_step_table" title="Link to this definition">¶</a></dt>
<dd><p>print useful output about refinement steps in the form of a simple table</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.rmsds">
<span class="sig-name descname"><span class="pre">rmsds</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.rmsds"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.rmsds" title="Link to this definition">¶</a></dt>
<dd><p>Return rmsds of the current model</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.rmsds_for_reflection_table">
<span class="sig-name descname"><span class="pre">rmsds_for_reflection_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.rmsds_for_reflection_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.rmsds_for_reflection_table" title="Link to this definition">¶</a></dt>
<dd><p>Calculate unweighted RMSDs for the specified reflections</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.run" title="Link to this definition">¶</a></dt>
<dd><p>Run refinement</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.Refiner.selection_used_for_refinement">
<span class="sig-name descname"><span class="pre">selection_used_for_refinement</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.selection_used_for_refinement"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.selection_used_for_refinement" title="Link to this definition">¶</a></dt>
<dd><p>Return a selection as a flex.bool in terms of the input reflection
data of those reflections that were used in the final step of
refinement.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.RefinerFactory">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.refiner.</span></span><span class="sig-name descname"><span class="pre">RefinerFactory</span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Factory class to create refiners</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.RefinerFactory.config_refinery">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">config_refinery</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pred_param</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constraints_manager</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_refinery"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_refinery" title="Link to this definition">¶</a></dt>
<dd><p>Given a set of parameters, a target class, a prediction
parameterisation class and a constraints_manager (which could be None),
build a refinery</p>
<dl class="simple">
<dt>Params:</dt><dd><p>params The input parameters</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The refinery instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.RefinerFactory.config_restraints">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">config_restraints</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pred_param</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_restraints"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_restraints" title="Link to this definition">¶</a></dt>
<dd><p>Given a set of user parameters plus a model parameterisation, create
restraints plus a parameterisation of these restraints</p>
<dl class="simple">
<dt>Params:</dt><dd><p>params: The input PHIL parameters
pred_param: A PredictionParameters object</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A restraints parameterisation or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.RefinerFactory.config_sparse">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">config_sparse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_sparse"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_sparse" title="Link to this definition">¶</a></dt>
<dd><p>Configure whether to use sparse datatypes</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.RefinerFactory.config_target">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">config_target</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflection_manager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pred_param</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restraints_param</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_stills</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_sparse</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_target"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_target" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.RefinerFactory.from_parameters_data_experiments">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_parameters_data_experiments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.from_parameters_data_experiments"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.from_parameters_data_experiments" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.RefinerFactory.reflections_after_outlier_rejection">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">reflections_after_outlier_rejection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.reflections_after_outlier_rejection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.reflections_after_outlier_rejection" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.refiner.ScanVaryingRefiner">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.refiner.</span></span><span class="sig-name descname"><span class="pre">ScanVaryingRefiner</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pred_param</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_reporter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refman</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refinery</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#ScanVaryingRefiner"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.ScanVaryingRefiner" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner" title="dials.algorithms.refinement.refiner.Refiner"><code class="xref py py-class docutils literal notranslate"><span class="pre">Refiner</span></code></a></p>
<p>Includes functionality to update the models with their states at
scan-points after scan-varying refinement</p>
</dd></dl>

<p id="module-dials.algorithms.refinement.engine">Contains classes for refinement engines. Refinery is the shared interface,
LevenbergMarquardtIterations, GaussNewtonIterations, SimpleLBFGS and LBFGScurvs
are the current concrete implementations</p>
<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLbfgs">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.engine.</span></span><span class="sig-name descname"><span class="pre">AdaptLbfgs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery" title="dials.algorithms.refinement.engine.Refinery"><code class="xref py py-class docutils literal notranslate"><span class="pre">Refinery</span></code></a></p>
<p>Adapt Refinery for L-BFGS minimiser</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLbfgs.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLbfgs.callback_after_step">
<span class="sig-name descname"><span class="pre">callback_after_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">minimizer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.callback_after_step"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.callback_after_step" title="Link to this definition">¶</a></dt>
<dd><p>Do journalling, evaluate rmsds and return True if the target is
reached to terminate the refinement.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_and_gradients">
<span class="sig-name descname"><span class="pre">compute_functional_and_gradients</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.compute_functional_and_gradients"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_and_gradients" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_gradients_and_curvatures">
<span class="sig-name descname"><span class="pre">compute_functional_gradients_and_curvatures</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.compute_functional_gradients_and_curvatures"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_gradients_and_curvatures" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLbfgs.run_lbfgs">
<span class="sig-name descname"><span class="pre">run_lbfgs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">curvatures</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.run_lbfgs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.run_lbfgs" title="Link to this definition">¶</a></dt>
<dd><p>Run the minimiser, keeping track of its log.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLstbx">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.engine.</span></span><span class="sig-name descname"><span class="pre">AdaptLstbx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constraints_manager</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tracking</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery" title="dials.algorithms.refinement.engine.Refinery"><code class="xref py py-class docutils literal notranslate"><span class="pre">Refinery</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">non_linear_ls</span></code>, <a class="reference external" href="https://cctbx.github.io/scitbx/scitbx.lstbx.html#scitbx.lstbx.normal_eqns.non_linear_ls_mixin" title="(in CCTBX vNone)"><code class="xref py py-class docutils literal notranslate"><span class="pre">non_linear_ls_mixin</span></code></a></p>
<p>Adapt Refinery for lstbx</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLstbx.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">(object)arg1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">(object)n_parameters</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span> <span class="pre">:</span></span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.__init__" title="Link to this definition">¶</a></dt>
<dd><blockquote>
<div><dl class="simple">
<dt>C++ signature :</dt><dd><p>void __init__(_object*,int)</p>
</dd>
</dl>
</div></blockquote>
<p>__init__( (object)arg1, (object)n_equations, (object)objective, (double)opposite_of_grad_objective, (object)normal_matrix) -&gt; None :</p>
<blockquote>
<div><dl class="simple">
<dt>C++ signature :</dt><dd><p>void __init__(_object*,unsigned long,double,scitbx::af::shared&lt;double&gt;,scitbx::af::versa&lt;double, scitbx::af::packed_u_accessor&gt;)</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLstbx.build_up">
<span class="sig-name descname"><span class="pre">build_up</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objective_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.build_up"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.build_up" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLstbx.calculate_esds">
<span class="sig-name descname"><span class="pre">calculate_esds</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.calculate_esds"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.calculate_esds" title="Link to this definition">¶</a></dt>
<dd><p>Calculate ESDs of parameters</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLstbx.parameter_vector_norm">
<span class="sig-name descname"><span class="pre">parameter_vector_norm</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.parameter_vector_norm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.parameter_vector_norm" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLstbx.restart">
<span class="sig-name descname"><span class="pre">restart</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.restart"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.restart" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLstbx.set_cholesky_factor">
<span class="sig-name descname"><span class="pre">set_cholesky_factor</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.set_cholesky_factor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.set_cholesky_factor" title="Link to this definition">¶</a></dt>
<dd><p>Set the Cholesky factor required for ESD calculation. This method is
valid only for the LSTBX dense matrix interface</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLstbx.step_backward">
<span class="sig-name descname"><span class="pre">step_backward</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.step_backward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.step_backward" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.AdaptLstbx.step_forward">
<span class="sig-name descname"><span class="pre">step_forward</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.step_forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.step_forward" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.DisableMPmixin">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.engine.</span></span><span class="sig-name descname"><span class="pre">DisableMPmixin</span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#DisableMPmixin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.DisableMPmixin" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A mixin class that disables setting of nproc for multiprocessing</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.DisableMPmixin.set_nproc">
<span class="sig-name descname"><span class="pre">set_nproc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nproc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#DisableMPmixin.set_nproc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.DisableMPmixin.set_nproc" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.GaussNewtonIterations">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.engine.</span></span><span class="sig-name descname"><span class="pre">GaussNewtonIterations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constraints_manager</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tracking</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#GaussNewtonIterations"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx" title="dials.algorithms.refinement.engine.AdaptLstbx"><code class="xref py py-class docutils literal notranslate"><span class="pre">AdaptLstbx</span></code></a>, <a class="reference external" href="https://cctbx.github.io/scitbx/scitbx.lstbx.html#scitbx.lstbx.normal_eqns_solving.iterations" title="(in CCTBX vNone)"><code class="xref py py-class docutils literal notranslate"><span class="pre">iterations</span></code></a></p>
<p>Refinery implementation, using lstbx Gauss Newton iterations</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.GaussNewtonIterations.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">(object)arg1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">(object)n_parameters</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span> <span class="pre">:</span></span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#GaussNewtonIterations.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.__init__" title="Link to this definition">¶</a></dt>
<dd><blockquote>
<div><dl class="simple">
<dt>C++ signature :</dt><dd><p>void __init__(_object*,int)</p>
</dd>
</dl>
</div></blockquote>
<p>__init__( (object)arg1, (object)n_equations, (object)objective, (double)opposite_of_grad_objective, (object)normal_matrix) -&gt; None :</p>
<blockquote>
<div><dl class="simple">
<dt>C++ signature :</dt><dd><p>void __init__(_object*,unsigned long,double,scitbx::af::shared&lt;double&gt;,scitbx::af::versa&lt;double, scitbx::af::packed_u_accessor&gt;)</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.GaussNewtonIterations.convergence_as_shift_over_esd">
<span class="sig-name descname"><span class="pre">convergence_as_shift_over_esd</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1e-05</span></em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.convergence_as_shift_over_esd" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.GaussNewtonIterations.damping_value">
<span class="sig-name descname"><span class="pre">damping_value</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.0007</span></em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.damping_value" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.GaussNewtonIterations.gradient_threshold">
<span class="sig-name descname"><span class="pre">gradient_threshold</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1e-10</span></em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.gradient_threshold" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.GaussNewtonIterations.max_shift_over_esd">
<span class="sig-name descname"><span class="pre">max_shift_over_esd</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">15</span></em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.max_shift_over_esd" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.GaussNewtonIterations.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#GaussNewtonIterations.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.run" title="Link to this definition">¶</a></dt>
<dd><p>To be implemented by derived class. It is expected that each step of
refinement be preceded by a call to prepare_for_step and followed by
calls to update_journal and test_for_termination (in that order).</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.GaussNewtonIterations.step_threshold">
<span class="sig-name descname"><span class="pre">step_threshold</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.step_threshold" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Journal">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.engine.</span></span><span class="sig-name descname"><span class="pre">Journal</span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a></p>
<p>Container in which to store information about refinement history.</p>
<p>This is simply a dict but provides some extra methods for access that
maintain values as columns in a table. Refinery classes will use these methods
while entering data to ensure the table remains consistent. Methods inherited
from dict are not hidden for ease of use of this object when returned to the
user.</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Journal.add_column">
<span class="sig-name descname"><span class="pre">add_column</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.add_column"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.add_column" title="Link to this definition">¶</a></dt>
<dd><p>Add a new column named by key</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Journal.add_row">
<span class="sig-name descname"><span class="pre">add_row</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.add_row"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.add_row" title="Link to this definition">¶</a></dt>
<dd><p>Add an element to the end of each of the columns. Fail if any columns
are the wrong length</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Journal.del_last_row">
<span class="sig-name descname"><span class="pre">del_last_row</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.del_last_row"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.del_last_row" title="Link to this definition">¶</a></dt>
<dd><p>Delete the last element from the each of the columns. Fail if any columns
are the wrong length</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Journal.from_json_file">
<em class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_json_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.from_json_file"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.from_json_file" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Journal.get_nrows">
<span class="sig-name descname"><span class="pre">get_nrows</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.get_nrows"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.get_nrows" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Journal.reason_for_termination">
<span class="sig-name descname"><span class="pre">reason_for_termination</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.reason_for_termination" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Journal.set_last_cell">
<span class="sig-name descname"><span class="pre">set_last_cell</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.set_last_cell"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.set_last_cell" title="Link to this definition">¶</a></dt>
<dd><p>Set last cell in column given by key to value. Fail if the column is the
wrong length</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Journal.to_json_file">
<span class="sig-name descname"><span class="pre">to_json_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.to_json_file"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.to_json_file" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.LBFGScurvs">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.engine.</span></span><span class="sig-name descname"><span class="pre">LBFGScurvs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LBFGScurvs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LBFGScurvs" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs" title="dials.algorithms.refinement.engine.AdaptLbfgs"><code class="xref py py-class docutils literal notranslate"><span class="pre">AdaptLbfgs</span></code></a></p>
<p>Refinery implementation using cctbx LBFGS with curvatures</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.LBFGScurvs.compute_functional_gradients_diag">
<span class="sig-name descname"><span class="pre">compute_functional_gradients_diag</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LBFGScurvs.compute_functional_gradients_diag"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LBFGScurvs.compute_functional_gradients_diag" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.LBFGScurvs.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LBFGScurvs.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LBFGScurvs.run" title="Link to this definition">¶</a></dt>
<dd><p>To be implemented by derived class. It is expected that each step of
refinement be preceded by a call to prepare_for_step and followed by
calls to update_journal and test_for_termination (in that order).</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.engine.</span></span><span class="sig-name descname"><span class="pre">LevenbergMarquardtIterations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constraints_manager</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tracking</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.GaussNewtonIterations" title="dials.algorithms.refinement.engine.GaussNewtonIterations"><code class="xref py py-class docutils literal notranslate"><span class="pre">GaussNewtonIterations</span></code></a></p>
<p>Refinery implementation, employing lstbx Levenberg Marquadt
iterations</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.add_constant_to_diagonal">
<span class="sig-name descname"><span class="pre">add_constant_to_diagonal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mu</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.add_constant_to_diagonal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.add_constant_to_diagonal" title="Link to this definition">¶</a></dt>
<dd><p>Add the constant value mu to the diagonal of the normal matrix</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.mu">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">mu</span></span><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.mu" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.report_progress">
<span class="sig-name descname"><span class="pre">report_progress</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objective</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.report_progress"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.report_progress" title="Link to this definition">¶</a></dt>
<dd><p>Callback within the refinement main loop that can be overridden to
report the value of the objective function (and possibly) other details for
long-running methods</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.run" title="Link to this definition">¶</a></dt>
<dd><p>To be implemented by derived class. It is expected that each step of
refinement be preceded by a call to prepare_for_step and followed by
calls to update_journal and test_for_termination (in that order).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.setup_mu">
<span class="sig-name descname"><span class="pre">setup_mu</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.setup_mu"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.setup_mu" title="Link to this definition">¶</a></dt>
<dd><p>Setup initial value for mu</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.tau">
<span class="sig-name descname"><span class="pre">tau</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.001</span></em><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.tau" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Refinery">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.engine.</span></span><span class="sig-name descname"><span class="pre">Refinery</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#dials.algorithms.refinement.target.Target" title="dials.algorithms.refinement.target.Target"><span class="pre">Target</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constraints_manager</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tracking</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Interface for Refinery objects. This should be subclassed and the run
method implemented.</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Refinery.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#dials.algorithms.refinement.target.Target" title="dials.algorithms.refinement.target.Target"><span class="pre">Target</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constraints_manager</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tracking</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Refinery.get_correlation_matrix_for_step">
<span class="sig-name descname"><span class="pre">get_correlation_matrix_for_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">step</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.get_correlation_matrix_for_step"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.get_correlation_matrix_for_step" title="Link to this definition">¶</a></dt>
<dd><p>For each type of residual (e.g. X, Y, Phi), decompress and return the
full 2D correlation matrix between columns of the Jacobian that was
stored in the journal at the given step number. If not available, return
None</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Refinery.get_num_steps">
<span class="sig-name descname"><span class="pre">get_num_steps</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.get_num_steps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.get_num_steps" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Refinery.jacobian_condition_number">
<span class="sig-name descname"><span class="pre">jacobian_condition_number</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.jacobian_condition_number"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.jacobian_condition_number" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the condition number of the Jacobian, for tracking in the
refinement journal, if requested. The condition number of a matrix A is
defined as cond(A) = ||A|| ||inv(A)||. For a rectangular matrix the inverse
operation refers to the Moore-Penrose pseudoinverse. Various matrix norms
can be used, resulting in numerically different condition numbers, however
the 2-norm is commonly used. In that case, the definition is equivalent
to the ratio of the largest to smallest singular values of the matrix:
cond(A) = sig_(A) / sig_min(A). That is the calculation that is performed
here.</p>
<p>The condition number is a measure of how accurate the solution x to the
equation Ax = b will be. Essentially it measures how errors are amplified
through the linear equation. The condition number is large in the case that
the columns of A are nearly linearly-dependent (and infinite for a singular
matrix). We use it here then to detect situations where the correlation
between effects of different parameter shifts becomes large and therefore
refinement is problematic.</p>
<p>Note, the Jacobian used here does not include any additional rows due to
restraints terms that might be applied, or any parameter reduction due to
constraints. Therefore this condition number relates to the pure linearised
(Gauss-Newton) step, which might not actually be what the refinement engine
uses. It can be indicative of issues in the fundamental set up of the least
squares problem, even if these issues are avoided in practice (e.g. by
use of an algorithm like Levenberg-Marquardt, inclusion of restraints or
parameter reduction).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Refinery.prepare_for_step">
<span class="sig-name descname"><span class="pre">prepare_for_step</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.prepare_for_step"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.prepare_for_step" title="Link to this definition">¶</a></dt>
<dd><p>Update the parameterisation and prepare the target function</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Refinery.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.run" title="Link to this definition">¶</a></dt>
<dd><p>To be implemented by derived class. It is expected that each step of
refinement be preceded by a call to prepare_for_step and followed by
calls to update_journal and test_for_termination (in that order).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Refinery.set_nproc">
<span class="sig-name descname"><span class="pre">set_nproc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nproc</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.set_nproc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.set_nproc" title="Link to this definition">¶</a></dt>
<dd><p>Set number of processors for multiprocessing. Override in derived classes
if a policy dictates that this must not be user-controlled</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Refinery.split_jacobian_into_blocks">
<span class="sig-name descname"><span class="pre">split_jacobian_into_blocks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://cctbx.github.io/scitbx/scitbx.array_family.html#scitbx.array_family.flex.double" title="(in CCTBX vNone)"><span class="pre">double</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.split_jacobian_into_blocks"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.split_jacobian_into_blocks" title="Link to this definition">¶</a></dt>
<dd><p>Split the Jacobian into blocks each corresponding to a separate
residual, converting sparse to flex.double if appropriate</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Refinery.test_for_termination">
<span class="sig-name descname"><span class="pre">test_for_termination</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.test_for_termination"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.test_for_termination" title="Link to this definition">¶</a></dt>
<dd><p>Return True if refinement should be terminated</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Refinery.test_objective_increasing_but_not_nref">
<span class="sig-name descname"><span class="pre">test_objective_increasing_but_not_nref</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.test_objective_increasing_but_not_nref"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.test_objective_increasing_but_not_nref" title="Link to this definition">¶</a></dt>
<dd><p>Test for an increase in the objective value between steps. This
could be caused simply by the number of matches between observations
and predictions increasing. However, if the number of matches stayed
the same or reduced then this is a bad sign.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Refinery.test_rmsd_convergence">
<span class="sig-name descname"><span class="pre">test_rmsd_convergence</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.test_rmsd_convergence"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.test_rmsd_convergence" title="Link to this definition">¶</a></dt>
<dd><p>Test for convergence of RMSDs</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.Refinery.update_journal">
<span class="sig-name descname"><span class="pre">update_journal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.update_journal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.update_journal" title="Link to this definition">¶</a></dt>
<dd><p>Append latest step information to the journal attributes</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.SimpleLBFGS">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.engine.</span></span><span class="sig-name descname"><span class="pre">SimpleLBFGS</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#SimpleLBFGS"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.SimpleLBFGS" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs" title="dials.algorithms.refinement.engine.AdaptLbfgs"><code class="xref py py-class docutils literal notranslate"><span class="pre">AdaptLbfgs</span></code></a></p>
<p>Refinery implementation, using cctbx LBFGS with basic settings</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.engine.SimpleLBFGS.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#SimpleLBFGS.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.SimpleLBFGS.run" title="Link to this definition">¶</a></dt>
<dd><p>To be implemented by derived class. It is expected that each step of
refinement be preceded by a call to prepare_for_step and followed by
calls to update_journal and test_for_termination (in that order).</p>
</dd></dl>

</dd></dl>

<p id="module-dials.algorithms.refinement.target">Contains classes used to construct a target function for refinement,
principally Target and ReflectionManager.</p>
<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.LaueLeastSquaresResidualWithRmsdCutoff">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.target.</span></span><span class="sig-name descname"><span class="pre">LaueLeastSquaresResidualWithRmsdCutoff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflection_manager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restraints_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frac_binsize_cutoff</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.33333</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">absolute_cutoffs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><span class="pre">list</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_calculation_blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LaueLeastSquaresResidualWithRmsdCutoff"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LaueLeastSquaresResidualWithRmsdCutoff" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.Target" title="dials.algorithms.refinement.target.Target"><code class="xref py py-class docutils literal notranslate"><span class="pre">Target</span></code></a></p>
<p>A Laue implementation of the target class providing a least squares
residual in terms of detector impact position X, Y, and observed
wavelength</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.LaueLeastSquaresResidualWithRmsdCutoff.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflection_manager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restraints_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frac_binsize_cutoff</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.33333</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">absolute_cutoffs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><span class="pre">list</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_calculation_blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LaueLeastSquaresResidualWithRmsdCutoff.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LaueLeastSquaresResidualWithRmsdCutoff.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.LaueLeastSquaresResidualWithRmsdCutoff.achieved">
<span class="sig-name descname"><span class="pre">achieved</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LaueLeastSquaresResidualWithRmsdCutoff.achieved"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LaueLeastSquaresResidualWithRmsdCutoff.achieved" title="Link to this definition">¶</a></dt>
<dd><p>RMSD criterion for target achieved</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.LaueLeastSquaresResidualWithRmsdCutoff.rmsd_names">
<span class="sig-name descname"><span class="pre">rmsd_names</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">['RMSD_X',</span> <span class="pre">'RMSD_Y',</span> <span class="pre">'RMSD_wavelength']</span></em><a class="headerlink" href="#dials.algorithms.refinement.target.LaueLeastSquaresResidualWithRmsdCutoff.rmsd_names" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.LaueLeastSquaresResidualWithRmsdCutoff.rmsd_units">
<span class="sig-name descname"><span class="pre">rmsd_units</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">['mm',</span> <span class="pre">'mm',</span> <span class="pre">'A']</span></em><a class="headerlink" href="#dials.algorithms.refinement.target.LaueLeastSquaresResidualWithRmsdCutoff.rmsd_units" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.target.</span></span><span class="sig-name descname"><span class="pre">LeastSquaresPositionalResidualWithRmsdCutoff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflection_manager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restraints_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frac_binsize_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33333</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">absolute_cutoffs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_calculation_blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LeastSquaresPositionalResidualWithRmsdCutoff"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.Target" title="dials.algorithms.refinement.target.Target"><code class="xref py py-class docutils literal notranslate"><span class="pre">Target</span></code></a></p>
<p>An implementation of the target class providing a least squares residual
in terms of detector impact position X, Y and phi, terminating on achieved
rmsd (or on intrisic convergence of the chosen minimiser)</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflection_manager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restraints_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frac_binsize_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33333</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">absolute_cutoffs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_calculation_blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LeastSquaresPositionalResidualWithRmsdCutoff.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.achieved">
<span class="sig-name descname"><span class="pre">achieved</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LeastSquaresPositionalResidualWithRmsdCutoff.achieved"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.achieved" title="Link to this definition">¶</a></dt>
<dd><p>RMSD criterion for target achieved</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoffSparse">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.target.</span></span><span class="sig-name descname"><span class="pre">LeastSquaresPositionalResidualWithRmsdCutoffSparse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflection_manager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restraints_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frac_binsize_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33333</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">absolute_cutoffs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_calculation_blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LeastSquaresPositionalResidualWithRmsdCutoffSparse"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoffSparse" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.SparseGradientsMixin" title="dials.algorithms.refinement.target.SparseGradientsMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">SparseGradientsMixin</span></code></a>, <a class="reference internal" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff" title="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff"><code class="xref py py-class docutils literal notranslate"><span class="pre">LeastSquaresPositionalResidualWithRmsdCutoff</span></code></a></p>
<p>A version of the LeastSquaresPositionalResidualWithRmsdCutoff Target that
uses a sparse matrix data structure for memory efficiency when there are a
large number of Experiments</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.SparseGradientsMixin">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.target.</span></span><span class="sig-name descname"><span class="pre">SparseGradientsMixin</span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#SparseGradientsMixin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.SparseGradientsMixin" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Mixin class to build a sparse Jacobian from gradients of the prediction
formula stored as sparse vectors, and allow concatenation of gradient vectors
that employed sparse storage.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.TOFLeastSquaresResidualWithRmsdCutoff">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.target.</span></span><span class="sig-name descname"><span class="pre">TOFLeastSquaresResidualWithRmsdCutoff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflection_manager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restraints_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frac_binsize_cutoff</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.33333</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">absolute_cutoffs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><span class="pre">list</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_calculation_blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#TOFLeastSquaresResidualWithRmsdCutoff"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.TOFLeastSquaresResidualWithRmsdCutoff" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.LaueLeastSquaresResidualWithRmsdCutoff" title="dials.algorithms.refinement.target.LaueLeastSquaresResidualWithRmsdCutoff"><code class="xref py py-class docutils literal notranslate"><span class="pre">LaueLeastSquaresResidualWithRmsdCutoff</span></code></a></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.TOFLeastSquaresResidualWithRmsdCutoff.rmsd_names">
<span class="sig-name descname"><span class="pre">rmsd_names</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">['RMSD_X',</span> <span class="pre">'RMSD_Y',</span> <span class="pre">'RMSD_wavelength',</span> <span class="pre">'RMSD_wavelength']</span></em><a class="headerlink" href="#dials.algorithms.refinement.target.TOFLeastSquaresResidualWithRmsdCutoff.rmsd_names" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.TOFLeastSquaresResidualWithRmsdCutoff.rmsd_units">
<span class="sig-name descname"><span class="pre">rmsd_units</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">['mm',</span> <span class="pre">'mm',</span> <span class="pre">'A',</span> <span class="pre">'frame']</span></em><a class="headerlink" href="#dials.algorithms.refinement.target.TOFLeastSquaresResidualWithRmsdCutoff.rmsd_units" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.target.</span></span><span class="sig-name descname"><span class="pre">Target</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflection_manager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restraints_parameterisation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_calculation_blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Abstract interface for a target function class</p>
<p>A Target object will be used by a Refinery. It will refer to a Reflection
Manager to get a list of observations. It will perform reflection prediction
on those observations and update the reflection manager with those
predictions. It will then query the reflection manager to get a list of
accepted reflections with observed and calculated positions. These are the
reflections for use in refinement. It obtains the gradients of reflection
positions from a relevant prediction parameterisation object. With all of
this information in place, it calculates the value of the target function,
the gradients of the target function and auxiliary information (e.g. RMSDs).</p>
<p>Concrete instances of this class implement the actual target function
calculation. The base class should not determine what type of target
function is used (e.g. least squares target), or limit whether the object
is used for a detector space &amp; phi residual, or a reciprocal space residual.
This should all be set by a derived class.</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflection_manager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restraints_parameterisation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_calculation_blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.achieved">
<span class="sig-name descname"><span class="pre">achieved</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.achieved"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.achieved" title="Link to this definition">¶</a></dt>
<dd><p>return True to terminate the refinement.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.calculate_gradients">
<span class="sig-name descname"><span class="pre">calculate_gradients</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callback</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.calculate_gradients"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.calculate_gradients" title="Link to this definition">¶</a></dt>
<dd><p>delegate to the prediction_parameterisation object to calculate
gradients for all the matched reflections, or just for those specified</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.compute_functional_gradients_and_curvatures">
<span class="sig-name descname"><span class="pre">compute_functional_gradients_and_curvatures</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">block</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_functional_gradients_and_curvatures"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_functional_gradients_and_curvatures" title="Link to this definition">¶</a></dt>
<dd><p>calculate the value of the target function and its gradients. Set
approximate curvatures as a side-effect</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.compute_residuals">
<span class="sig-name descname"><span class="pre">compute_residuals</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_residuals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_residuals" title="Link to this definition">¶</a></dt>
<dd><p>return the vector of residuals plus their weights</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.compute_residuals_and_gradients">
<span class="sig-name descname"><span class="pre">compute_residuals_and_gradients</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">block</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><span class="pre">tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://cctbx.github.io/scitbx/scitbx.array_family.html#scitbx.array_family.flex.double" title="(in CCTBX vNone)"><span class="pre">double</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">matrix</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_residuals_and_gradients"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_residuals_and_gradients" title="Link to this definition">¶</a></dt>
<dd><p>return the vector of residuals plus their gradients and weights for
non-linear least squares methods</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.compute_restraints_functional_gradients_and_curvatures">
<span class="sig-name descname"><span class="pre">compute_restraints_functional_gradients_and_curvatures</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_restraints_functional_gradients_and_curvatures"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_restraints_functional_gradients_and_curvatures" title="Link to this definition">¶</a></dt>
<dd><p>use the restraints_parameterisation object, if present, to
calculate the least squares restraints objective plus gradients and
approximate curvatures</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.compute_restraints_residuals_and_gradients">
<span class="sig-name descname"><span class="pre">compute_restraints_residuals_and_gradients</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_restraints_residuals_and_gradients"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_restraints_residuals_and_gradients" title="Link to this definition">¶</a></dt>
<dd><p>delegate to the restraints_parameterisation object, if present, to
calculate the vector of restraints residuals plus their gradients and
weights for non-linear least squares methods</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.dim">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dim</span></span><a class="headerlink" href="#dials.algorithms.refinement.target.Target.dim" title="Link to this definition">¶</a></dt>
<dd><p>Get the number of dimensions of the target function</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.get_num_matches">
<span class="sig-name descname"><span class="pre">get_num_matches</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.get_num_matches"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.get_num_matches" title="Link to this definition">¶</a></dt>
<dd><p>return the number of reflections currently used in the calculation</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.get_num_matches_for_experiment">
<span class="sig-name descname"><span class="pre">get_num_matches_for_experiment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iexp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.get_num_matches_for_experiment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.get_num_matches_for_experiment" title="Link to this definition">¶</a></dt>
<dd><p>return the number of reflections currently used in the calculation</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.get_num_matches_for_panel">
<span class="sig-name descname"><span class="pre">get_num_matches_for_panel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ipanel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.get_num_matches_for_panel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.get_num_matches_for_panel" title="Link to this definition">¶</a></dt>
<dd><p>return the number of reflections currently used in the calculation</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.predict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.predict" title="Link to this definition">¶</a></dt>
<dd><p>perform reflection prediction for the working reflections and update the
reflection manager</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.predict_for_free_reflections">
<span class="sig-name descname"><span class="pre">predict_for_free_reflections</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.predict_for_free_reflections"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.predict_for_free_reflections" title="Link to this definition">¶</a></dt>
<dd><p>perform prediction for the reflections not used for refinement</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.predict_for_reflection_table">
<span class="sig-name descname"><span class="pre">predict_for_reflection_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_derivatives</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.predict_for_reflection_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.predict_for_reflection_table" title="Link to this definition">¶</a></dt>
<dd><p>perform prediction for all reflections in the supplied table</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.rmsd_names">
<span class="sig-name descname"><span class="pre">rmsd_names</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">['RMSD_X',</span> <span class="pre">'RMSD_Y',</span> <span class="pre">'RMSD_Phi']</span></em><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsd_names" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.rmsd_units">
<span class="sig-name descname"><span class="pre">rmsd_units</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">['mm',</span> <span class="pre">'mm',</span> <span class="pre">'rad']</span></em><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsd_units" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.rmsds">
<span class="sig-name descname"><span class="pre">rmsds</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds" title="Link to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the matches</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.rmsds_for_experiment">
<span class="sig-name descname"><span class="pre">rmsds_for_experiment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iexp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds_for_experiment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds_for_experiment" title="Link to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the selected experiment.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.rmsds_for_panel">
<span class="sig-name descname"><span class="pre">rmsds_for_panel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ipanel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds_for_panel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds_for_panel" title="Link to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the selected panel.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.rmsds_for_reflection_table">
<span class="sig-name descname"><span class="pre">rmsds_for_reflection_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds_for_reflection_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds_for_reflection_table" title="Link to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the specified reflections. Caution: this
assumes that the table reflections has the keys expected by _rmsds_core</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.split_matches_into_blocks">
<span class="sig-name descname"><span class="pre">split_matches_into_blocks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nproc</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.split_matches_into_blocks"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.split_matches_into_blocks" title="Link to this definition">¶</a></dt>
<dd><p>Return a list of the matches, split into blocks according to the
gradient_calculation_blocksize parameter and the number of processes (if relevant).
The number of blocks will be set such that the total number of reflections
being processed by concurrent processes does not exceed gradient_calculation_blocksize</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.Target.update_matches">
<span class="sig-name descname"><span class="pre">update_matches</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">force</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.update_matches"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.update_matches" title="Link to this definition">¶</a></dt>
<dd><p>ensure the observations matched to predictions are up to date</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.TargetFactory">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.target.</span></span><span class="sig-name descname"><span class="pre">TargetFactory</span></span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#TargetFactory"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.TargetFactory" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target.TargetFactory.from_parameters_and_experiments">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_parameters_and_experiments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflection_manager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pred_param</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restraints_param</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_stills</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_sparse</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#TargetFactory.from_parameters_and_experiments"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target.TargetFactory.from_parameters_and_experiments" title="Link to this definition">¶</a></dt>
<dd><p>Given a set of parameters, configure a factory to build a
target function</p>
<dl class="simple">
<dt>Params:</dt><dd><p>params The input parameters</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The target factory instance</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-dials.algorithms.refinement.target_stills">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.target_stills.</span></span><span class="sig-name descname"><span class="pre">LeastSquaresStillsResidualWithRmsdCutoff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflection_manager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restraints_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frac_binsize_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33333</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">absolute_cutoffs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_calculation_blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoff"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.Target" title="dials.algorithms.refinement.target.Target"><code class="xref py py-class docutils literal notranslate"><span class="pre">Target</span></code></a></p>
<p>An implementation of the target class providing a least squares residual
in terms of detector impact position X, Y and minimum rotation to the Ewald
sphere, DeltaPsi. Terminates refinement on achieved rmsd (or on intrisic
convergence of the chosen minimiser)</p>
<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflection_manager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restraints_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frac_binsize_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33333</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">absolute_cutoffs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_calculation_blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoff.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.__init__" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.achieved">
<span class="sig-name descname"><span class="pre">achieved</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoff.achieved"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.achieved" title="Link to this definition">¶</a></dt>
<dd><p>RMSD criterion for target achieved</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table">
<span class="sig-name descname"><span class="pre">predict_for_reflection_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reflections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_derivatives</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table" title="Link to this definition">¶</a></dt>
<dd><p>perform prediction for all reflections in the supplied table</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_names">
<span class="sig-name descname"><span class="pre">rmsd_names</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">['RMSD_X',</span> <span class="pre">'RMSD_Y',</span> <span class="pre">'RMSD_DeltaPsi']</span></em><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_names" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_units">
<span class="sig-name descname"><span class="pre">rmsd_units</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">['mm',</span> <span class="pre">'mm',</span> <span class="pre">'rad']</span></em><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_units" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoffSparse">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dials.algorithms.refinement.target_stills.</span></span><span class="sig-name descname"><span class="pre">LeastSquaresStillsResidualWithRmsdCutoffSparse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reflection_manager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prediction_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restraints_parameterisation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frac_binsize_cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33333</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">absolute_cutoffs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_calculation_blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoffSparse"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoffSparse" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.SparseGradientsMixin" title="dials.algorithms.refinement.target.SparseGradientsMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">SparseGradientsMixin</span></code></a>, <a class="reference internal" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff" title="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff"><code class="xref py py-class docutils literal notranslate"><span class="pre">LeastSquaresStillsResidualWithRmsdCutoff</span></code></a></p>
<p>A version of the LeastSquaresStillsResidualWithRmsdCutoff Target that
uses a sparse matrix data structure for memory efficiency when there are a
large number of Experiments</p>
</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper"><!--<h3>Navigation</h3>-->
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../howto.html">How-to</a></li>
<li class="toctree-l1"><a class="reference external" href="https://dials.github.io/kb">Knowledge Base</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workshops/index.html">Workshops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../national_resource.html">US National Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../projects.html">Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer container">
  <a href="https://www.diamond.ac.uk/"><img class="logofooter" alt="Diamond" src="../../../_static/diamond_logo.png" /></a>
  <a href="https://www.ccp4.ac.uk/"><img class="logofooter" alt="CCP4" src="../../../_static/CCP4-logo-plain.png" /></a>
  <a href="https://www.stfc.ac.uk/"><img class="logofooter" alt="STFC" src="https://dials.github.io/images/logos/ukri-stfc.png" /></a>
  <a href="https://www.lbl.gov/"><img class="logofooter" alt="LBL" src="https://dials.github.io/images/logos/lbl.png" /></a>
  <a href="http://smb.slac.stanford.edu/"><img class="logofooter" alt="SSRL/SMB" src="https://dials.github.io/images/logos/smbssrl.jpg" /></a>
  </div>

  <script type="text/javascript">
     $(document).ready(function() {
         $(".toggle > *").hide();
         $(".toggle .header").show();
         $(".toggle .header").click(function() {
             $(this).parent().children().not(".header").toggle(400);
             $(this).parent().children(".header").toggleClass("open");
         })
     });
  </script>
  
    <div class="footer">
      &#169;2025, Diamond Light Source, Lawrence Berkeley National Laboratory and STFC.
      
    </div>

    

    

  </body>
</html>