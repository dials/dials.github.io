


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>dials.integrate &#8212; DIALS  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/dials-styles.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="dials.cosym" href="dials_cosym.html" />
    <link rel="prev" title="dials.refine" href="dials_refine.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="logoheader container">
  <a href="../../index.html">
  <img class="logoheader" alt="DIALS" src="../../_static/dials_header.png" />
  </a>
  </div>
  

  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="dials-integrate">
<h1>dials.integrate<a class="headerlink" href="#dials-integrate" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This program is used to integrate the reflections on the diffraction images. It
is called with an experiment list outputted from dials.index or dials.refine and
a corresponding set of strong spots from which a profile model is calculated.
The program will output a set of integrated reflections and an experiment list
with additional profile model data. The data can be reintegrated using the same
profile model by inputting this integrated.expt file back into
dials.integate.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dials</span><span class="o">.</span><span class="n">integrate</span> <span class="n">models</span><span class="o">.</span><span class="n">expt</span> <span class="n">refined</span><span class="o">.</span><span class="n">refl</span>

<span class="n">dials</span><span class="o">.</span><span class="n">integrate</span> <span class="n">models</span><span class="o">.</span><span class="n">expt</span> <span class="n">refined</span><span class="o">.</span><span class="n">refl</span> <span class="n">output</span><span class="o">.</span><span class="n">reflections</span><span class="o">=</span><span class="n">integrated</span><span class="o">.</span><span class="n">refl</span>

<span class="n">dials</span><span class="o">.</span><span class="n">integrate</span> <span class="n">models</span><span class="o">.</span><span class="n">expt</span> <span class="n">refined</span><span class="o">.</span><span class="n">refl</span> <span class="n">profile</span><span class="o">.</span><span class="n">fitting</span><span class="o">=</span><span class="kc">False</span>

<span class="n">dials</span><span class="o">.</span><span class="n">integrate</span> <span class="n">models</span><span class="o">.</span><span class="n">expt</span> <span class="n">refined</span><span class="o">.</span><span class="n">refl</span> <span class="n">background</span><span class="o">.</span><span class="n">algorithm</span><span class="o">=</span><span class="n">glm</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-parameters">
<h2>Basic parameters<a class="headerlink" href="#basic-parameters" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="p">{</span>
  <span class="n">experiments</span> <span class="o">=</span> <span class="s1">&#39;integrated.expt&#39;</span>
  <span class="n">reflections</span> <span class="o">=</span> <span class="s1">&#39;integrated.refl&#39;</span>
  <span class="n">phil</span> <span class="o">=</span> <span class="s1">&#39;dials.integrate.phil&#39;</span>
  <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;dials.integrate.log&#39;</span>
  <span class="n">report</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">include_bad_reference</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">}</span>
<span class="n">scan_range</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">create_profile_model</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">exclude_images</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">integration</span> <span class="p">{</span>
  <span class="n">lookup</span> <span class="p">{</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="p">}</span>
  <span class="n">block</span> <span class="p">{</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">auto</span>
    <span class="n">units</span> <span class="o">=</span> <span class="o">*</span><span class="n">degrees</span> <span class="n">radians</span> <span class="n">frames</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.99</span>
    <span class="n">force</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">max_memory_usage</span> <span class="o">=</span> <span class="mf">0.75</span>
  <span class="p">}</span>
  <span class="n">use_dynamic_mask</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="n">debug</span> <span class="p">{</span>
    <span class="n">reference</span> <span class="p">{</span>
      <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;reference_profiles.refl&quot;</span>
      <span class="n">output</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">}</span>
    <span class="n">during</span> <span class="o">=</span> <span class="n">modelling</span> <span class="o">*</span><span class="n">integration</span>
    <span class="n">output</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">separate_files</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">delete_shoeboxes</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">select</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">split_experiments</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="p">}</span>
  <span class="n">profile</span> <span class="p">{</span>
    <span class="n">fitting</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">validation</span> <span class="p">{</span>
      <span class="n">number_of_partitions</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">min_partition_size</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">overlaps_filter</span> <span class="p">{</span>
    <span class="n">foreground_foreground</span> <span class="p">{</span>
      <span class="n">enable</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">}</span>
    <span class="n">foreground_background</span> <span class="p">{</span>
      <span class="n">enable</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">mp</span> <span class="p">{</span>
    <span class="n">method</span> <span class="o">=</span> <span class="o">*</span><span class="n">none</span> <span class="n">drmaa</span> <span class="n">sge</span> <span class="n">lsf</span> <span class="n">pbs</span>
    <span class="n">njobs</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">nproc</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="p">}</span>
  <span class="n">summation</span> <span class="p">{</span>
    <span class="n">detector_gain</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="p">}</span>
  <span class="n">background</span> <span class="p">{</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="o">*</span><span class="n">glm</span> <span class="n">gmodel</span> <span class="n">simple</span> <span class="n">null</span> <span class="n">median</span>
    <span class="n">glm</span> <span class="p">{</span>
      <span class="n">robust</span> <span class="p">{</span>
        <span class="n">tuning_constant</span> <span class="o">=</span> <span class="mf">1.345</span>
      <span class="p">}</span>
      <span class="n">model</span> <span class="p">{</span>
        <span class="n">algorithm</span> <span class="o">=</span> <span class="n">constant2d</span> <span class="o">*</span><span class="n">constant3d</span> <span class="n">loglinear2d</span> <span class="n">loglinear3d</span>
      <span class="p">}</span>
      <span class="n">min_pixels</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="p">}</span>
    <span class="n">gmodel</span> <span class="p">{</span>
      <span class="n">robust</span> <span class="p">{</span>
        <span class="n">algorithm</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">tuning_constant</span> <span class="o">=</span> <span class="mf">1.345</span>
      <span class="p">}</span>
      <span class="n">min_pixels</span> <span class="o">=</span> <span class="mi">10</span>
      <span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">}</span>
    <span class="n">simple</span> <span class="p">{</span>
      <span class="n">outlier</span> <span class="p">{</span>
        <span class="n">algorithm</span> <span class="o">=</span> <span class="o">*</span><span class="n">null</span> <span class="n">nsigma</span> <span class="n">truncated</span> <span class="n">normal</span> <span class="n">plane</span> <span class="n">tukey</span>
      <span class="p">}</span>
      <span class="n">model</span> <span class="p">{</span>
        <span class="n">algorithm</span> <span class="o">=</span> <span class="n">constant2d</span> <span class="o">*</span><span class="n">constant3d</span> <span class="n">linear2d</span> <span class="n">linear3d</span>
      <span class="p">}</span>
      <span class="n">min_pixels</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="p">}</span>
    <span class="n">median</span> <span class="p">{</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">centroid</span> <span class="p">{</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="o">*</span><span class="n">simple</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">profile</span> <span class="p">{</span>
  <span class="n">algorithm</span> <span class="o">=</span> <span class="o">*</span><span class="n">gaussian_rs</span>
  <span class="n">gaussian_rs</span> <span class="p">{</span>
    <span class="n">scan_varying</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">min_spots</span> <span class="p">{</span>
      <span class="n">overall</span> <span class="o">=</span> <span class="mi">50</span>
      <span class="n">per_degree</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="p">}</span>
    <span class="n">sigma_m_algorithm</span> <span class="o">=</span> <span class="n">basic</span> <span class="o">*</span><span class="n">extended</span>
    <span class="n">centroid_definition</span> <span class="o">=</span> <span class="n">com</span> <span class="o">*</span><span class="n">s1</span>
    <span class="n">parameters</span> <span class="p">{</span>
      <span class="n">n_sigma</span> <span class="o">=</span> <span class="mf">3.0</span>
      <span class="n">sigma_b</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="n">sigma_m</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">}</span>
    <span class="nb">filter</span> <span class="p">{</span>
      <span class="n">min_zeta</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="p">}</span>
    <span class="n">fitting</span> <span class="p">{</span>
      <span class="n">scan_step</span> <span class="o">=</span> <span class="mi">5</span>
      <span class="n">grid_size</span> <span class="o">=</span> <span class="mi">5</span>
      <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.02</span>
      <span class="n">grid_method</span> <span class="o">=</span> <span class="n">single</span> <span class="o">*</span><span class="n">regular_grid</span> <span class="n">circular_grid</span> <span class="n">spherical_grid</span>
      <span class="n">fit_method</span> <span class="o">=</span> <span class="o">*</span><span class="n">reciprocal_space</span> <span class="n">detector_space</span>
      <span class="n">detector_space</span> <span class="p">{</span>
        <span class="n">deconvolution</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">prediction</span> <span class="p">{</span>
  <span class="n">d_min</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">d_max</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">margin</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">force_static</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">padding</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="p">}</span>
<span class="n">absorption_correction</span> <span class="p">{</span>
  <span class="n">apply</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">algorithm</span> <span class="o">=</span> <span class="n">fuller_kapton</span> <span class="n">kapton_2019</span> <span class="n">other</span>
  <span class="n">fuller_kapton</span> <span class="p">{</span>
    <span class="n">xtal_height_above_kapton_mm</span> <span class="p">{</span>
      <span class="n">value</span> <span class="o">=</span> <span class="mf">0.02</span>
      <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="p">}</span>
    <span class="n">rotation_angle_deg</span> <span class="p">{</span>
      <span class="n">value</span> <span class="o">=</span> <span class="mf">1.15</span>
      <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="p">}</span>
    <span class="n">kapton_half_width_mm</span> <span class="p">{</span>
      <span class="n">value</span> <span class="o">=</span> <span class="mf">1.5875</span>
      <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="p">}</span>
    <span class="n">kapton_thickness_mm</span> <span class="p">{</span>
      <span class="n">value</span> <span class="o">=</span> <span class="mf">0.05</span>
      <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.005</span>
    <span class="p">}</span>
    <span class="n">smart_sigmas</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">within_spot_sigmas</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="full-parameter-definitions">
<h2>Full parameter definitions<a class="headerlink" href="#full-parameter-definitions" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="p">{</span>
  <span class="n">experiments</span> <span class="o">=</span> <span class="s1">&#39;integrated.expt&#39;</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The experiments output filename&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">str</span>
  <span class="n">reflections</span> <span class="o">=</span> <span class="s1">&#39;integrated.refl&#39;</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The integrated output filename&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">str</span>
  <span class="n">phil</span> <span class="o">=</span> <span class="s1">&#39;dials.integrate.phil&#39;</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The output phil file&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">str</span>
  <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;dials.integrate.log&#39;</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The log filename&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">str</span>
  <span class="n">report</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The integration report filename (*.xml or *.json)&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">str</span>
  <span class="n">include_bad_reference</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Include bad reference data including unindexed spots, and&quot;</span>
            <span class="s2">&quot;reflections whose predictions are messed up in the reflection&quot;</span>
            <span class="s2">&quot;table output. Reflections will have the &#39;bad_reference&#39; flag set.&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
<span class="p">}</span>
<span class="n">scan_range</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Explicitly specify the images to be processed. Only applicable when&quot;</span>
          <span class="s2">&quot;experiment list contains a single imageset.&quot;</span>
  <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ints</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
  <span class="o">.</span><span class="n">multiple</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">create_profile_model</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Create the profile model&quot;</span>
  <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
<span class="n">sampling</span>
  <span class="o">.</span><span class="n">expert_level</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">{</span>
  <span class="n">reflections_per_degree</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The number of predicted reflections per degree of the sweep  to&quot;</span>
            <span class="s2">&quot;integrate.&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">minimum_sample_size</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;cutoff that determines whether subsetting of the input &quot;</span>
            <span class="s2">&quot;prediction list is done&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">maximum_sample_size</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The maximum number of predictions to integrate. Overrides&quot;</span>
            <span class="s2">&quot;reflections_per_degree if that produces a larger sample size.&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">integrate_all_reflections</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Override reflections_per_degree and integrate all predicted&quot;</span>
            <span class="s2">&quot;reflections.&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
<span class="p">}</span>
<span class="n">exclude_images</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Exclude images from integration (e.g. 1,2,3,4,5 etc)&quot;</span>
  <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ints</span>
<span class="n">integration</span> <span class="p">{</span>
  <span class="n">lookup</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Parameters specifying lookup file path&quot;</span>
  <span class="p">{</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The path to the mask file.&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">str</span>
  <span class="p">}</span>
  <span class="n">block</span> <span class="p">{</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">auto</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The block size in rotation angle (degrees).&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">units</span> <span class="o">=</span> <span class="o">*</span><span class="n">degrees</span> <span class="n">radians</span> <span class="n">frames</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The units of the block size&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.99</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;For block size auto the block size is calculated by sorting&quot;</span>
              <span class="s2">&quot;reflections by the number of frames they cover and then&quot;</span>
              <span class="s2">&quot;selecting the block size to be 2*nframes[threshold] such that&quot;</span>
              <span class="s2">&quot;100*threshold </span><span class="si">% o</span><span class="s2">f reflections are guarenteed to be fully&quot;</span>
              <span class="s2">&quot;contained in 1 block&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value_max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">force</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;If the number of processors is 1 and force is False, then the&quot;</span>
              <span class="s2">&quot;number of blocks may be set to 1. If force is True then the&quot;</span>
              <span class="s2">&quot;block size is always calculated.&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
    <span class="n">max_memory_usage</span> <span class="o">=</span> <span class="mf">0.75</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The maximum percentage of total physical memory to use for&quot;</span>
              <span class="s2">&quot;allocating shoebox arrays.&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value_max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="n">use_dynamic_mask</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Use dynamic mask if available&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
  <span class="n">debug</span> <span class="p">{</span>
    <span class="n">reference</span> <span class="p">{</span>
      <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;reference_profiles.refl&quot;</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The filename for the reference profiles&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">str</span>
      <span class="n">output</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Save the reference profiles&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
    <span class="p">}</span>
    <span class="n">during</span> <span class="o">=</span> <span class="n">modelling</span> <span class="o">*</span><span class="n">integration</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Do debugging during modelling or integration&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
    <span class="n">output</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Save shoeboxes after each processing task.&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
    <span class="n">separate_files</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;If this is true, the shoeboxes are saved in separate files from&quot;</span>
              <span class="s2">&quot;the output integrated.refl file. This is necessary in most&quot;</span>
              <span class="s2">&quot;cases since the amount of memory used by the shoeboxes is&quot;</span>
              <span class="s2">&quot;typically greater than the available system memory. If,&quot;</span>
              <span class="s2">&quot;however, you know that memory is not an issue, you can saved&quot;</span>
              <span class="s2">&quot;the shoeboxes in the integrated.refl file by setting this&quot;</span>
              <span class="s2">&quot;option to False. This only works if the debug output is during&quot;</span>
              <span class="s2">&quot;integrated and not modelling.&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
    <span class="n">delete_shoeboxes</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Delete shoeboxes immediately before saving files. This option&quot;</span>
              <span class="s2">&quot;in combination with debug.output=True enables intermediate&quot;</span>
              <span class="s2">&quot;processing steps to make use of shoeboxes.&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
    <span class="n">select</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;A string specifying the selection. The string should be of the&quot;</span>
              <span class="s2">&quot;form: select=$</span><span class="si">{COLUMN}</span><span class="s2">[&lt;|&lt;=|==|!=|&gt;=|&gt;]$</span><span class="si">{VALUE}</span><span class="s2">. In addition to&quot;</span>
              <span class="s2">&quot;the items in the reflection table, the following implicit&quot;</span>
              <span class="s2">&quot;columns are defined if the necessary data is there: &quot;</span>
              <span class="s2">&quot;intensity.sum.i_over_sigma  intensity.prf.i_over_sigma&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">reflection_table_selector</span>
    <span class="n">split_experiments</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Split shoeboxes into different files&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
  <span class="p">}</span>
  <span class="n">profile</span> <span class="p">{</span>
    <span class="n">fitting</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Use profile fitting if available&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
    <span class="n">validation</span> <span class="p">{</span>
      <span class="n">number_of_partitions</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The number of subsamples to take from the reference spots. If&quot;</span>
                <span class="s2">&quot;the value is 1, then no validation is performed.&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">min_partition_size</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The minimum number of spots to use in each subsample.&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nb">filter</span>
    <span class="o">.</span><span class="n">expert_level</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="p">{</span>
    <span class="n">min_zeta</span> <span class="o">=</span> <span class="mf">0.05</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Filter the reflections by the value of zeta. A value of less&quot;</span>
              <span class="s2">&quot;than or equal to zero indicates that this will not be used. A&quot;</span>
              <span class="s2">&quot;positive value is used as the minimum permissable value.&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value_max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">max_shoebox_overlap</span> <span class="o">=</span> <span class="mf">1.0</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Filter reflections whose shoeboxes are overlapped by greater&quot;</span>
              <span class="s2">&quot;than the requested amount. Note that this is not the percentage&quot;</span>
              <span class="s2">&quot;of the peak that is overlapped but rather the percentage of the&quot;</span>
              <span class="s2">&quot;shoebox (background and foreground). This can be useful when&quot;</span>
              <span class="s2">&quot;the detector is too close and many overlapping reflections are&quot;</span>
              <span class="s2">&quot;predicted at high resolution causing memory issues.&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value_max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ice_rings</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Set the ice ring flags&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
  <span class="p">}</span>
  <span class="n">overlaps_filter</span> <span class="p">{</span>
    <span class="n">foreground_foreground</span> <span class="p">{</span>
      <span class="n">enable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Remove all spots in which neighbors&#39; foreground impinges on&quot;</span>
                <span class="s2">&quot;the spot&#39;s foreground&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
    <span class="p">}</span>
    <span class="n">foreground_background</span> <span class="p">{</span>
      <span class="n">enable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Remove all spots in which neighbors&#39; foreground impinges on&quot;</span>
                <span class="s2">&quot;the spot&#39;s background&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">mp</span> <span class="p">{</span>
    <span class="n">method</span> <span class="o">=</span> <span class="o">*</span><span class="n">none</span> <span class="n">drmaa</span> <span class="n">sge</span> <span class="n">lsf</span> <span class="n">pbs</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The cluster method to use&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
    <span class="n">njobs</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The number of cluster jobs to use&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">nproc</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The number of processes to use per cluster job&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="n">summation</span> <span class="p">{</span>
    <span class="n">detector_gain</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Multiplier for variances after integration of still images. See&quot;</span>
              <span class="s2">&quot;Leslie 1999.&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="n">background</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Extensions for background algorithms.&quot;</span>
  <span class="p">{</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="o">*</span><span class="n">glm</span> <span class="n">gmodel</span> <span class="n">simple</span> <span class="n">null</span> <span class="n">median</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The choice of algorithm&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
    <span class="n">glm</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;An extension class implementing a robust GLM background&quot;</span>
              <span class="s2">&quot;algorithm.&quot;</span>
    <span class="p">{</span>
      <span class="n">robust</span> <span class="p">{</span>
        <span class="n">tuning_constant</span> <span class="o">=</span> <span class="mf">1.345</span>
          <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The tuning constant for robust estimation&quot;</span>
          <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="n">model</span> <span class="p">{</span>
        <span class="n">algorithm</span> <span class="o">=</span> <span class="n">constant2d</span> <span class="o">*</span><span class="n">constant3d</span> <span class="n">loglinear2d</span> <span class="n">loglinear3d</span>
          <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The background model to fit&quot;</span>
          <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
      <span class="p">}</span>
      <span class="n">min_pixels</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The minimum number of pixels required&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">gmodel</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;An extension class implementing a robust GLM background&quot;</span>
              <span class="s2">&quot;algorithm.&quot;</span>
    <span class="p">{</span>
      <span class="n">robust</span> <span class="p">{</span>
        <span class="n">algorithm</span> <span class="o">=</span> <span class="kc">False</span>
          <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Use the robust algorithm&quot;</span>
          <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
        <span class="n">tuning_constant</span> <span class="o">=</span> <span class="mf">1.345</span>
          <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The tuning constant for robust estimation&quot;</span>
          <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="n">min_pixels</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The minimum number of pixels required&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The model filename&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="p">}</span>
    <span class="n">simple</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;An extension class implementing simple background subtraction.&quot;</span>
    <span class="p">{</span>
      <span class="n">outlier</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Outlier rejection prior to background fit&quot;</span>
      <span class="p">{</span>
        <span class="n">algorithm</span> <span class="o">=</span> <span class="o">*</span><span class="n">null</span> <span class="n">nsigma</span> <span class="n">truncated</span> <span class="n">normal</span> <span class="n">plane</span> <span class="n">tukey</span>
          <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The outlier rejection algorithm.&quot;</span>
          <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
        <span class="n">nsigma</span>
          <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Parameters for nsigma outlier rejector&quot;</span>
          <span class="o">.</span><span class="n">expert_level</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="p">{</span>
          <span class="n">lower</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Lower n sigma&quot;</span>
            <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="n">upper</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Upper n sigma&quot;</span>
            <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">truncated</span>
          <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Parameters for truncated outlier rejector&quot;</span>
          <span class="o">.</span><span class="n">expert_level</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="p">{</span>
          <span class="n">lower</span> <span class="o">=</span> <span class="mf">0.01</span>
            <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Lower bound&quot;</span>
            <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="n">upper</span> <span class="o">=</span> <span class="mf">0.01</span>
            <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Upper bound&quot;</span>
            <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">normal</span>
          <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Parameters for normal outlier rejector&quot;</span>
          <span class="o">.</span><span class="n">expert_level</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="p">{</span>
          <span class="n">min_pixels</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The minimum number of pixels to use in calculating the&quot;</span>
                    <span class="s2">&quot;background intensity.&quot;</span>
            <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">plane</span>
          <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Parameters for mosflm-like outlier rejector. This algorithm&quot;</span>
                  <span class="s2">&quot;is mainly used in conjunction with a linear 2d background.&quot;</span>
          <span class="o">.</span><span class="n">expert_level</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="p">{</span>
          <span class="n">fraction</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The fraction of pixels to use in determining the initial&quot;</span>
                    <span class="s2">&quot;plane used for outlier rejection.&quot;</span>
            <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="n">n_sigma</span> <span class="o">=</span> <span class="mf">4.0</span>
            <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The number of standard deviations above the threshold&quot;</span>
                    <span class="s2">&quot;plane to use in rejecting outliers from background&quot;</span>
                    <span class="s2">&quot;calculation.&quot;</span>
            <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">tukey</span>
          <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Parameters for tukey outlier rejector&quot;</span>
          <span class="o">.</span><span class="n">expert_level</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="p">{</span>
          <span class="n">lower</span> <span class="o">=</span> <span class="mf">1.5</span>
            <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Lower IQR multiplier&quot;</span>
            <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="n">upper</span> <span class="o">=</span> <span class="mf">1.5</span>
            <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Upper IQR multiplier&quot;</span>
            <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">model</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Background model&quot;</span>
      <span class="p">{</span>
        <span class="n">algorithm</span> <span class="o">=</span> <span class="n">constant2d</span> <span class="o">*</span><span class="n">constant3d</span> <span class="n">linear2d</span> <span class="n">linear3d</span>
          <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The choice of background model&quot;</span>
          <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
      <span class="p">}</span>
      <span class="n">min_pixels</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The minimum number of pixels to compute the background&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">median</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;An extension class implementing a median background algorithm.&quot;</span>
    <span class="p">{</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">centroid</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Extensions for centroid algorithms.&quot;</span>
  <span class="p">{</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="o">*</span><span class="n">simple</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The choice of algorithm&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">profile</span>
  <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The interface definition for a profile model.&quot;</span>
<span class="p">{</span>
  <span class="n">algorithm</span> <span class="o">=</span> <span class="o">*</span><span class="n">gaussian_rs</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The choice of algorithm&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
  <span class="n">gaussian_rs</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;An extension class implementing a reciprocal space gaussian&quot;</span>
            <span class="s2">&quot;profile model.&quot;</span>
  <span class="p">{</span>
    <span class="n">scan_varying</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Calculate a scan varying model&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
    <span class="n">min_spots</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;if (total_reflections &gt; overall or reflections_per_degree &gt;&quot;</span>
              <span class="s2">&quot;per_degree) then do the profile modelling.&quot;</span>
    <span class="p">{</span>
      <span class="n">overall</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The minimum number of spots needed to do the profile&quot;</span>
                <span class="s2">&quot;modelling&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">per_degree</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The minimum number of spots needed to do the profile&quot;</span>
                <span class="s2">&quot;modelling&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">sigma_m_algorithm</span> <span class="o">=</span> <span class="n">basic</span> <span class="o">*</span><span class="n">extended</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The algorithm to compute mosaicity&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
    <span class="n">centroid_definition</span> <span class="o">=</span> <span class="n">com</span> <span class="o">*</span><span class="n">s1</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The centroid to use as beam divergence (centre of mass or s1)&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
    <span class="n">parameters</span> <span class="p">{</span>
      <span class="n">n_sigma</span> <span class="o">=</span> <span class="mf">3.0</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Sigma multiplier for shoebox&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">sigma_b</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Override the sigma_b value (degrees)&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">sigma_m</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Override the sigma_m value (degrees)&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nb">filter</span> <span class="p">{</span>
      <span class="n">min_zeta</span> <span class="o">=</span> <span class="mf">0.05</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Filter reflections by min zeta&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">fitting</span> <span class="p">{</span>
      <span class="n">scan_step</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Space between profiles in degrees&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">grid_size</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The size of the profile grid.&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.02</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The threshold to use in reference profile&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">grid_method</span> <span class="o">=</span> <span class="n">single</span> <span class="o">*</span><span class="n">regular_grid</span> <span class="n">circular_grid</span> <span class="n">spherical_grid</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Select the profile grid method&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
      <span class="n">fit_method</span> <span class="o">=</span> <span class="o">*</span><span class="n">reciprocal_space</span> <span class="n">detector_space</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The fitting method&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
      <span class="n">detector_space</span> <span class="p">{</span>
        <span class="n">deconvolution</span> <span class="o">=</span> <span class="kc">False</span>
          <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Do deconvolution in detector space&quot;</span>
          <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">prediction</span> <span class="p">{</span>
  <span class="n">d_min</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The maximum resolution limit&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">d_max</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The minimum resolution limit&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">margin</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The margin to use to scan varying prediction&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">force_static</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;For scan-varying prediction force scan-static prediction&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
  <span class="n">padding</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The padding in degrees&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">significance_filter</span>
  <span class="o">.</span><span class="n">expert_level</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">{</span>
  <span class="n">enable</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;If enabled, the significance filter will, for every experiment,&quot;</span>
            <span class="s2">&quot;find the highest resolution where the I/sigI remains above a&quot;</span>
            <span class="s2">&quot;certain point (controlled by isigi_cutoff).&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
  <span class="n">d_min</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;High resolution cutoff for binning. If None, use the highest&quot;</span>
            <span class="s2">&quot;resolution reflection as d_min.&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">n_bins</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Number of bins to use when examining resolution falloff&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">isigi_cutoff</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;I/sigI cutoff. Reflections in and past the first bin that falls&quot;</span>
            <span class="s2">&quot;below this cutoff will not be retained&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">absorption_correction</span>
  <span class="o">.</span><span class="n">multiple</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">{</span>
  <span class="n">apply</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;must be supplied as a user-defined function with a specific&quot;</span>
            <span class="s2">&quot;interface (not documented)&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
  <span class="n">algorithm</span> <span class="o">=</span> <span class="n">fuller_kapton</span> <span class="n">kapton_2019</span> <span class="n">other</span>
    <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;a specific absorption correction, or implementation thereof&quot;</span>
            <span class="s2">&quot;kapton_2019 is a more general implementation of fuller_kapton for&quot;</span>
            <span class="s2">&quot;use on single/multi-panel detectors&quot;</span>
    <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">choice</span>
  <span class="n">fuller_kapton</span> <span class="p">{</span>
    <span class="n">xtal_height_above_kapton_mm</span> <span class="p">{</span>
      <span class="n">value</span> <span class="o">=</span> <span class="mf">0.02</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;height of the beam (or the irradiated crystal) above the&quot;</span>
                <span class="s2">&quot;kapton tape&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">rotation_angle_deg</span> <span class="p">{</span>
      <span class="n">value</span> <span class="o">=</span> <span class="mf">1.15</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;angle of the tape from vertical&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">kapton_half_width_mm</span> <span class="p">{</span>
      <span class="n">value</span> <span class="o">=</span> <span class="mf">1.5875</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;forward distance from irradiated crystal to edge of tape&quot;</span>
                <span class="s2">&quot;nearest detector&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">kapton_thickness_mm</span> <span class="p">{</span>
      <span class="n">value</span> <span class="o">=</span> <span class="mf">0.05</span>
        <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;tape thickness&quot;</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.005</span>
        <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">smart_sigmas</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;apply spot-specific sigma corrections using kapton param sigmas&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
    <span class="n">within_spot_sigmas</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;turn this off to get a major speed-up&quot;</span>
      <span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">bool</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><!--<h3>Navigation</h3>-->
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howto.html">How-to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workshops/index.html">Workshops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../links.html">Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer container">
  <a href="https://www.diamond.ac.uk/"><img class="logofooter" alt="Diamond" src="../../_static/diamond_logo.png" /></a>
  <a href="https://www.ccp4.ac.uk/"><img class="logofooter" alt="CCP4" src="../../_static/CCP4-logo-plain.png" /></a>
  <a href="https://www.lbl.gov/"><img class="logofooter" alt="LBL" src="../../_static/LBL-logo-wide.jpeg" /></a>
  <a href="https://www.stfc.ac.uk/"><img class="logofooter" alt="STFC" src="../../_static/STFC_logo.png" /></a>
  </div>

  <script type="text/javascript">
     $(document).ready(function() {
         $(".toggle > *").hide();
         $(".toggle .header").show();
         $(".toggle .header").click(function() {
             $(this).parent().children().not(".header").toggle(400);
             $(this).parent().children(".header").toggleClass("open");
         })
     });
  </script>
  
    <div class="footer">
      &copy;2019, Diamond Light Source, Lawrence Berkeley National Laboratory and STFC.
      
    </div>

    

    

  </body>
</html>